JS는 모르겠고
코어 자바스크립트는 머리아프고
리듬게임은 하고 싶은데 공부는 해야겠으니
리듬게임을 만들어서 하는 것이 목표다!!

목표
- JS로 웹 디자인하는 법을 익히기
- 리듬게임 간단히 만들기



오늘은 노트와 키빔을 디자인했다.
![[note.png]]
![[note_line.png]]

키빔은 정사각형이지만
세로로 쭉 늘리면 아무 문제 없다.

일단은 순수 js로 작성하고, 최적화나 기능이 필요할 때
외부 라이브러리의 힘을 빌려오자.

```js
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Document</title>
</head>
<body>
    <canvas id="canvas">
    </canvas>
    <script src="javascript/script.js"></script>
</body>
</html>
```

`css` 로 `<canvas>` 를 정 중앙으로 옮긴다.

```css
canvas {
    background-color: black;
    display: block;
    margin: auto;
}
```

canvas를 js에서 사용할 수 있게 불러와준다.

```js
let canvas = document.getElementById('canvas');
let ctx = canvas.getContext('2d');

canvas.width = window.innerWidth - 1000;
canvas.height = window.innerHeight - 50;
```

키빔의 `width`는  일단 `canvas` 의 `width` 의 $\frac{1}{4}$ 로 설정했다.
나중에 필요에 따라 변경 예정.

```js
const NOTE_LINE_WIDTH = canvas.width / 4;
const NOTE_LINE_HEIGHT = canvas.height;

let note_line_image = new Image();
note_line_image.src = 'img/note_line.png';
```

다음은 `Note` 클래스를 디자인해준다.
`NoteLine` 클래스를 만들지 않은 이유는, `Note` 를 먼저 만드는 것이
더 중요하다고 판단했다.

```js
class Note {
    constructor() {
        this.noteImage = new Image();
        this.noteImage.src = 'img/note.png';
        this.x = 0;
        this.y = 0;
    }
    draw() {
        ctx.drawImage(this.noteImage, this.x, this.y);
    }

    moveDown() {
        this.y++;
    }
}
```

다음은 프레임 단위로 키보드 입력을 받아서 키빔을 보여준다.
`C++` 을 주력 언어로 사용하다 보니 이미지 작업 부분에서 고민을 좀 했는데
그냥 구글링하니까 함수를 하나 주더라

`A` 키를 누르는 동안 1번 키빔을 보여주고
`S` 키를 누르는 동안 2번 키빔을 보여주고
`D` 키를 누르는 동안 3번 키빔을 보여주고
`F` 키를 누르는 동안 4번 키빔을 보여준다.

이를 담당할 변수를 하나 만들어야 하는데, 확장성을 위해
딕셔너리 형태로 관리한다.

변수명이 마음에 들지 않아 추후 교체 예정.

```js
let isPressed = {
    KEY_A: false,
    KEY_S: false,
    KEY_D: false,
    KEY_F: false
}
```

노트를 떨어뜨리는 작업은 아직 하지 않았다.
결국 노트는 1개가 아닌 여러 개가 나와야 하기 때문.

```js
function start_game_animation_frame() {

    requestAnimationFrame(start_game_animation_frame);

    // --- CLEAR CANVAS ---
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // --- MOVE NOTE ---
	

    // --- DRAW NOTE LINE ---
    if (isPressed.KEY_A) {
        ctx.drawImage(note_line_image, 0, 0,
            NOTE_LINE_WIDTH, NOTE_LINE_HEIGHT);
    }
    if (isPressed.KEY_S) {
        ctx.drawImage(note_line_image, NOTE_LINE_WIDTH, 0,
            NOTE_LINE_WIDTH, NOTE_LINE_HEIGHT);
    }
    if (isPressed.KEY_D) {
        ctx.drawImage(note_line_image, NOTE_LINE_WIDTH * 2, 0,
            NOTE_LINE_WIDTH, NOTE_LINE_HEIGHT);
    }
    if (isPressed.KEY_F) {
        ctx.drawImage(note_line_image, NOTE_LINE_WIDTH * 3, 0,
            NOTE_LINE_WIDTH, NOTE_LINE_HEIGHT);
    }

    // --- DRAW NOTE ---

}

start_game_animation_frame();
```

마지막으로, 위에서 변수를 통해 키빔 출력을 해주었으니
keyListener를 할당해준다.

키보드 입력이므로 `window.addEventListener` 를 사용한다.

```js
window.addEventListener('keydown', function(event) {
    if (event.key === 'a' || event.key === 'A') {
        isPressed.KEY_A = true;
    }
    if (event.key === 's' || event.key === 'S') {
        isPressed.KEY_S = true;
    }
    if (event.key === 'd' || event.key === 'D') {
        isPressed.KEY_D = true;
    }
    if (event.key === 'f' || event.key === 'F') {
        isPressed.KEY_F = true;
    }
});

window.addEventListener('keyup', function(event) {
    if (event.key === 'a' || event.key === 'A') {
        isPressed.KEY_A = false;
    }
    if (event.key === 's' || event.key === 'S') {
        isPressed.KEY_S = false;
    }
    if (event.key === 'd' || event.key === 'D') {
        isPressed.KEY_D = false;
    }
    if (event.key === 'f' || event.key === 'F') {
        isPressed.KEY_F = false;
    }
});
```

